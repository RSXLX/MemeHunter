---
status: 已审核
version: 1.0
last_updated: 2026-01-17
reviewer: 用户
---

# Meme Hunter MVP 需求设计

> 基于 MEmeHunter.md 方案，结合用户确认的技术选型进行需求分析

---

## 一、产品概述

### 1.1 产品愿景
Meme Hunter 是一款基于 Monad 区块链的实时多人捕捉游戏。玩家通过点击画布发射捕网，捕获 Meme 赚取 MON 代币。

### 1.2 核心用户路径
```
连接钱包 → 充值 MON → 授权 Session Key → 进入游戏 → 点击狩猎 → 获取奖励/扣费 → 提现
```

### 1.3 MVP 功能边界

| ✅ 保留 | ❌ 砍掉 |
|---------|---------|
| 钱包连接登录 | 扫码加入 |
| 预充值/提现 | 房间创建 |
| Session Key 授权 | 房间选择 |
| 核心狩猎玩法 | 多房间系统 |
| 捕网发射动画 | 复杂配置项 |
| Meme 捕获/逃脱动画 | 排行榜 |
| 玩家列表显示 | 社交功能 |

---

## 二、用户场景

### 场景 1: 首次进入游戏 (新用户)

**前置条件**: 用户首次访问网站

**用户操作流程**:
1. 用户看到首页，点击 "Connect Wallet"
2. MetaMask 弹出连接确认
3. 连接成功后，检测余额为 0
4. 弹出充值引导，用户输入充值金额并确认
5. 充值成功后，弹出 Session Key 授权引导
6. 用户签名授权 Session Key（24小时有效）
7. 授权成功，自动跳转游戏页

**异常场景**:
- 用户拒绝连接钱包 → 显示重新连接按钮
- 充值交易失败 → 显示错误提示，可重试
- Session Key 签名被拒绝 → 显示重新授权按钮

---

### 场景 2: 核心狩猎 (游戏进行中)

**前置条件**: 用户已在游戏页，余额 > 0，Session Key 有效

**用户操作流程**:
1. 用户看到画布上有多个移动的 Meme 精灵
2. 用户选择捕网大小（小/中/大）
3. 用户点击画布某位置
4. 立即播放捕网发射动画
5. 系统判断点击范围内是否有 Meme
   - 无 Meme → 播放空网动画，显示提示
   - 有 Meme → 发送狩猎请求到 Relayer
6. Relayer 验证签名，调用合约执行
7. 合约返回结果（成功/失败由伪随机决定）
   - 成功 → 播放捕获动画，显示 "+X MON"
   - 失败 → 播放逃脱动画，显示 "-X MON"
8. 余额实时更新

**异常场景**:
- 余额不足 → 提示充值
- Session Key 过期 → 弹出重新授权
- Relayer 请求失败 → 显示错误，可重试
- 网络断开 → 显示重连提示

---

### 场景 3: 提现 (结束游戏)

**前置条件**: 用户合约余额 > 0

**用户操作流程**:
1. 用户点击余额区域或"退出房间"
2. 弹出提现弹窗，显示当前余额
3. 用户选择提现金额（可全额提现）
4. 确认后，MetaMask 弹出交易签名
5. 交易成功后，余额更新

**异常场景**:
- 余额为 0 → 禁用提现按钮
- 交易失败 → 显示错误，可重试

---

### 场景 4: 回归用户

**前置条件**: 用户之前已玩过游戏

**用户操作流程**:
1. 用户再次访问网站
2. 钱包自动连接（如果用户设置了自动连接）
3. 检查余额 - 如有余额则跳过充值步骤
4. 检查 Session Key - 如有效则直接进入游戏
5. 如 Session Key 过期，提示重新授权

---

## 三、功能需求明细

### 3.1 钱包连接模块

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 连接 MetaMask | 支持 MetaMask 钱包连接 | P0 |
| 网络切换 | 自动检测并提示切换到 Monad Testnet | P0 |
| 地址显示 | 顶部显示缩略地址 (0x1234...5678) | P0 |
| 断开连接 | 支持断开钱包连接 | P1 |

---

### 3.2 余额管理模块

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 充值 | 将 MON 从钱包转入合约 | P0 |
| 提现 | 将 MON 从合约提回钱包 | P0 |
| 余额查询 | 实时显示合约内余额 | P0 |
| 充值引导 | 首次进入时引导充值 | P0 |
| 最小充值额 | 设置 0.1 MON 最小充值 | P1 |

---

### 3.3 Session Key 模块

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 生成密钥对 | 本地生成临时私钥 | P0 |
| 授权签名 | 用户签名授权 Session Key | P0 |
| 合约注册 | 调用合约注册 Session Key | P0 |
| 有效期检查 | 24小时过期，自动提示续期 | P0 |
| 本地存储 | 加密存储在 localStorage | P0 |
| 撤销授权 | 支持手动撤销 | P2 |

---

### 3.4 游戏核心模块

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 画布渲染 | 800x600 Canvas 游戏画布 | P0 |
| Meme 精灵 | 5 种 Meme，不同稀有度和速度 | P0 |
| Meme 移动 | 随机移动逻辑，边界反弹 | P0 |
| 捕网选择 | 小/中/大三种网，不同费用和成功率 | P0 |
| 点击检测 | 检测点击位置与 Meme 碰撞 | P0 |
| 狩猎请求 | 构造签名请求发送 Relayer | P0 |
| 结果处理 | 根据结果播放对应动画 | P0 |

---

### 3.5 动画系统模块

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 捕网发射 | 点击后网从中心扩散 | P0 |
| 捕获成功 | 粒子爆炸 + Meme 消失 + 收益文字 | P0 |
| 捕获失败 | Meme 逃跑 + 烟尘效果 + 扣费文字 | P0 |
| 空网提示 | 灰色虚线网 + 摇晃效果 | P0 |
| 余额变化 | 数字滚动动画 | P1 |

---

### 3.6 实时同步模块

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| WebSocket 连接 | 与 Relayer 建立实时连接 | P0 |
| Meme 位置同步 | 所有玩家看到相同 Meme 位置 | P0 |
| 玩家列表 | 显示当前在线玩家 | P0 |
| 捕获广播 | 某玩家捕获成功时其他玩家看到 | P1 |
| 断线重连 | 自动重连机制 | P1 |

---

## 四、非功能需求

### 4.1 性能要求

| 指标 | 要求 |
|------|------|
| 页面加载 | < 3 秒 |
| 动画帧率 | 60 FPS |
| 狩猎响应 | < 2 秒 (含链上确认) |
| 同屏 Meme | 最多 10 个 |
| 同时在线 | 支持 10 人 |

### 4.2 安全要求

| 类别 | 要求 |
|------|------|
| Session Key | 24 小时过期 |
| 余额限制 | Session Key 只能操作合约内余额 |
| 签名验证 | Relayer 验证 EIP-712 签名 |
| 私钥存储 | Session Key 私钥加密存储 |

---

## 五、技术约束 (用户已确认)

| 配置项 | 值 |
|--------|------|
| Network Name | Monad Testnet |
| RPC URL | https://testnet-rpc.monad.xyz |
| Chain ID | 10143 |
| Currency Symbol | MON |
| Block Explorer | https://testnet.monadexplorer.com |
| 随机数方案 | 伪随机 (keccak256) |
| Session Key 方案 | 自定义 mapping |
| 前端初始化 | create-vite 模板 |
| 合约初始化 | forge init |

---

## 六、假设清单

1. **Monad 测试网稳定性**: 假设测试网可用率 > 95%
2. **Gas 费用**: 假设 Gas 价格稳定，不需要动态调整
3. **用户群体**: 假设用户熟悉 MetaMask 操作
4. **并发规模**: MVP 阶段假设 < 50 并发用户

---

## 七、内部讨论记录

### 讨论主题: Session Key 实现方案

**产品经理**: 用户最关心的是"无签名狩猎"的体验，每次狩猎都弹签名窗口是不可接受的。

**架构师**: 有两个方案:
- EIP-4337 Account Abstraction: 功能强大，但 Monad 支持度不明确，开发复杂
- 自定义 mapping: 简单直接，合约维护 sessionKey => (owner, expiresAt)

**测试工程师**: 自定义方案需要关注:
- Session Key 被盗用的风险（本地存储安全）
- 过期处理的边界情况

**用户代言人**: 用户已明确选择自定义 mapping 方案。

**最终决策**:
- 采用自定义 mapping 方案
- Session Key 有效期 24 小时
- 私钥加密存储在 localStorage
- 理由：简单可控，符合 MVP 快速迭代目标

---

### 讨论主题: 随机数方案

**架构师**: VRF 能保证公平性，但:
- Chainlink VRF 在 Monad 测试网不可用
- 自建 VRF 成本太高

**测试工程师**: 伪随机的漏洞:
- 矿工可预测结果（但 Monad 不是 PoW）
- 用户可通过模拟预测（但 Relayer 统一提交，用户无法控制 block）

**最终决策**:
- MVP 使用伪随机: `keccak256(block.timestamp, msg.sender, nonce)`
- 通过 Relayer 统一提交，降低可预测性
- 理由：MVP 阶段可接受，后续可升级

---

## 八、验收标准

| 场景 | 验收条件 |
|------|----------|
| 新用户首次进入 | 能完成 连接→充值→授权→进入游戏 全流程 |
| 狩猎操作 | 点击后 < 100ms 看到动画反馈 |
| 捕获成功 | 余额实时增加，动画流畅 |
| 捕获失败 | 余额实时减少，逃脱动画合理 |
| 空网操作 | 不发送链上交易，有明确提示 |
| 提现 | 能将合约余额提回钱包 |
| 多人同步 | 所有玩家看到相同 Meme 位置 |

---

## 变更记录

| 日期 | 变更内容 |
|------|----------|
| 2026-01-17 | 初始版本，基于用户确认的技术选型 |
