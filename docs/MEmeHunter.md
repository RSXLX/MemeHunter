# 🎯 Meme Hunter MVP 精简开发方案

> 砍掉扫码加入，钱包连接即玩，聚焦核心狩猎体验

---

## 一、产品定义

### 核心体验
```
连接钱包 → 自动进入公共房间 → 点击狩猎 → 看到结果
```

### MVP 功能边界

| ✅ 保留 | ❌ 砍掉 |
|---------|---------|
| 钱包连接登录 | 扫码加入 |
| 预充值/提现 | 房间创建 |
| Session Key 授权 | 房间选择 |
| 核心狩猎玩法 | 多房间系统 |
| 捕网发射动画 | 复杂配置项 |
| Meme 捕获/逃脱动画 | 排行榜 |
| 玩家列表显示 | 社交功能 |

---

## 二、页面结构 (仅 2 页)

```
┌─────────────────────────────────────┐
│                                     │
│   Page 1: 首页/登录页               │
│   - 连接钱包                        │
│   - 首次充值引导                    │
│   - Session Key 授权                │
│                                     │
├─────────────────────────────────────┤
│                                     │
│   Page 2: 游戏主页 (核心)           │
│   - 游戏画布                        │
│   - 狩猎交互                        │
│   - 动画反馈                        │
│                                     │
└─────────────────────────────────────┘
```

---

## 三、界面设计详解

### 📱 Page 1: 首页/登录页

```
┌────────────────────────────────────────────────────────────┐
│                                                            │
│                                                            │
│         ███╗   ███╗███████╗███╗   ███╗███████╗            │
│         ████╗ ████║██╔════╝████╗ ████║██╔════╝            │
│         ██╔████╔██║█████╗  ██╔████╔██║█████╗              │
│         ██║╚██╔╝██║██╔══╝  ██║╚██╔╝██║██╔══╝              │
│         ██║ ╚═╝ ██║███████╗██║ ╚═╝ ██║███████╗            │
│         ╚═╝     ╚═╝╚══════╝╚═╝     ╚═╝╚══════╝            │
│                  🎯 HUNTER 🎯                              │
│                                                            │
│              [🐸] [🦊] [🐶] [💎] [🚀]                      │
│                    ← 漂浮动画 →                            │
│                                                            │
│            ╔══════════════════════════════╗                │
│            ║   🔗 CONNECT WALLET          ║                │
│            ╚══════════════════════════════╝                │
│                                                            │
│                 Powered by MONAD ⚡                        │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

**状态流转：**

```
[未连接] → 点击 Connect Wallet
    ↓
[连接中] → 显示钱包选择 (MetaMask)
    ↓
[已连接 - 余额不足] → 显示充值弹窗
    ↓
[已连接 - 无Session Key] → 显示授权弹窗  
    ↓
[准备就绪] → 按钮变为 "🎮 ENTER GAME" → 自动跳转游戏页
```

---

### 📱 Page 2: 游戏主页 (核心界面)

```
┌────────────────────────────────────────────────────────────┐
│  [💰 1.50 MON]        MEME HUNTER         [🚪 退出房间]   │
├────────────────────────────────────────────────────────────┤
│                                                            │
│   ┌────────────────────────────────────────────────────┐  │
│   │                                                    │  │
│   │      ┌────┐                         ┌────┐        │  │
│   │      │ 🐸 │        ┌────┐           │ 🦊 │        │  │
│   │      └────┘        │ 🐶 │           └────┘        │  │
│   │                    └────┘                          │  │
│   │   ┌────┐                              ┌────┐      │  │
│   │   │ 💎 │                              │ 🚀 │      │  │
│   │   └────┘      👆 点击此处狩猎          └────┘      │  │
│   │                                                    │  │
│   │                    ┌────┐                          │  │
│   │                    │ 🐸 │                          │  │
│   │                    └────┘                          │  │
│   │                                                    │  │
│   └────────────────────────────────────────────────────┘  │
│                        800 x 600                          │
│                                                            │
├────────────────────────────────────────────────────────────┤
│                                                            │
│   👤You ●  👤Player2 ●  👤Player3 ○  ...    [6/10 人]    │
│                                                            │
├────────────────────────────────────────────────────────────┤
│                                                            │
│   网大小:  [🔘小]  [⚪中]  [⚪大]      费用: 0.01 MON/次   │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

## 四、核心动画设计

### 动画 1: 捕网发射

```
帧 1 (0ms)        帧 2 (100ms)       帧 3 (200ms)       帧 4 (300ms)
点击位置          网展开中            网完全展开          网收缩判定
                                     
    ·               ╭─╮              ╭─────╮            ╭───╮
                    │ │              │     │            │ ● │
                   ╰─╯              │     │            ╰───╯
                                    ╰─────╯            
                   
 [触发点击]      [圆形扩散]        [最大范围]         [收网判定]
```

**CSS/Canvas 实现要点：**
- 从点击中心向外扩散的圆形/网状图案
- 扩散到设定大小后短暂停留
- 收缩时触发碰撞检测

---

### 动画 2: 捕获成功 ✅

```
┌────────────────────────────────────────────┐
│                                            │
│              ✨ ✨ ✨ ✨ ✨                  │
│            ✨             ✨                │
│           ✨   ╭───────╮   ✨               │
│           ✨   │       │   ✨               │
│           ✨   │  🐸   │   ✨   ← Meme 被网住 │
│           ✨   │       │   ✨               │
│           ✨   ╰───────╯   ✨               │
│            ✨             ✨                │
│              ✨ ✨ ✨ ✨ ✨                  │
│                                            │
│            🎉 CAUGHT! 🎉                   │
│            +0.05 MON                       │
│                                            │
└────────────────────────────────────────────┘

动画序列:
1. 网收缩包住 Meme (200ms)
2. 粒子爆炸特效 (300ms)  
3. Meme 放大后消失 (200ms)
4. 显示收益文字浮动上升 (500ms)
```

---

### 动画 3: 捕获失败 / 逃脱 ❌

```
┌────────────────────────────────────────────┐
│                                            │
│           ╭───────╮                        │
│           │       │     💨                 │
│           │   ·   │        🐸 → →          │
│           │       │     💨    逃跑方向      │
│           ╰───────╯                        │
│                                            │
│            😅 ESCAPED!                     │
│            -0.01 MON                       │
│                                            │
└────────────────────────────────────────────┘

动画序列:
1. 网收缩但 Meme 滑出 (200ms)
2. Meme 加速逃离 + 烟尘效果 (300ms)
3. 网变灰色淡出 (200ms)
4. 显示消耗文字 (红色下沉) (500ms)
```

---

### 动画 4: 空网 (前端检测无 Meme)

```
┌────────────────────────────────────────────┐
│                                            │
│           ╭ ─ ─ ─ ─ ╮                      │
│           ╷         ╷                      │
│               🕸️        ← 灰色虚线网        │
│           ╵         ╵                      │
│           ╰ ─ ─ ─ ─ ╯                      │
│              ↙️ ↘️                          │
│             摇晃效果                        │
│                                            │
│          ⚠️ 这里没有 Meme!                  │
│                                            │
└────────────────────────────────────────────┘

动画序列:
1. 网展开为灰色虚线样式 (150ms)
2. 左右摇晃 2-3 次 (300ms)
3. 淡出消失 (150ms)
4. 浮动提示文字 (500ms)
```

---

## 五、技术架构

### 整体架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        前端 (React)                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ 钱包连接    │  │ 游戏引擎    │  │ Session Key 管理    │ │
│  │ (wagmi)     │  │ (Canvas)    │  │ (本地存储+签名)     │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└────────────────────────────┬────────────────────────────────┘
                             │
              ┌──────────────┼──────────────┐
              │              │              │
              ▼              ▼              ▼
┌─────────────────┐  ┌─────────────┐  ┌─────────────────────┐
│   Relayer API   │  │  WebSocket  │  │  Monad RPC          │
│   (狩猎请求)     │  │  (实时同步)  │  │  (充值/提现/授权)    │
└────────┬────────┘  └──────┬──────┘  └─────────────────────┘
         │                  │
         ▼                  ▼
┌─────────────────────────────────────────────────────────────┐
│                    Relayer 服务 (Node.js)                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ 签名验证    │  │ 交易广播    │  │ 房间状态管理        │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└────────────────────────────┬────────────────────────────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────┐
│                   Monad 智能合约                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐ │
│  │ 余额管理    │  │ Session Key │  │ 狩猎逻辑 + VRF      │ │
│  └─────────────┘  └─────────────┘  └─────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

---

### 前端模块划分

```
src/
├── pages/
│   ├── Home.tsx              # 首页（连接+授权）
│   └── Game.tsx              # 游戏页（核心）
│
├── components/
│   ├── common/
│   │   ├── Button.tsx        # 通用按钮
│   │   ├── Modal.tsx         # 弹窗
│   │   └── Toast.tsx         # 提示
│   │
│   ├── wallet/
│   │   ├── ConnectButton.tsx # 连接钱包按钮
│   │   ├── DepositModal.tsx  # 充值弹窗
│   │   └── BalanceDisplay.tsx# 余额显示
│   │
│   └── game/
│       ├── GameCanvas.tsx    # 游戏画布容器
│       ├── MemeSprite.tsx    # Meme 精灵
│       ├── HuntNet.tsx       # 捕网组件
│       ├── AnimationLayer.tsx# 动画层
│       ├── PlayerBar.tsx     # 玩家列表栏
│       └── ControlBar.tsx    # 底部控制栏
│
├── hooks/
│   ├── useWallet.ts          # 钱包连接
│   ├── useSessionKey.ts      # Session Key 管理
│   ├── useGameState.ts       # 游戏状态
│   ├── useHunt.ts            # 狩猎逻辑
│   └── useAnimations.ts      # 动画控制
│
├── services/
│   ├── relayer.ts            # Relayer API
│   ├── contract.ts           # 合约交互
│   └── websocket.ts          # 实时通信
│
├── game/
│   ├── engine.ts             # 游戏引擎核心
│   ├── collision.ts          # 碰撞检测
│   ├── memePool.ts           # Meme 生成逻辑
│   └── animations/
│       ├── netLaunch.ts      # 捕网发射动画
│       ├── captureSuccess.ts # 捕获成功动画
│       ├── captureEscape.ts  # 逃脱动画
│       └── emptyNet.ts       # 空网动画
│
└── utils/
    ├── constants.ts          # 常量配置
    └── helpers.ts            # 工具函数
```

---

### Relayer 模块划分

```
server/
├── index.ts                  # 入口
├── routes/
│   ├── hunt.ts               # POST /api/hunt
│   └── nonce.ts              # GET /api/nonce/:address
│
├── services/
│   ├── signatureVerifier.ts  # EIP-712 签名验证
│   ├── transactionBroadcaster.ts # 交易广播
│   └── roomManager.ts        # 房间状态管理
│
├── websocket/
│   └── gameSync.ts           # 实时同步 (Meme位置/玩家状态)
│
└── utils/
    ├── nonceManager.ts       # Nonce 管理
    └── config.ts             # 配置
```

---

### 智能合约模块

```
contracts/
├── MemeHunter.sol            # 主合约
│   ├── 余额管理
│   │   ├── deposit()
│   │   ├── withdraw()
│   │   └── balanceOf()
│   │
│   ├── Session Key 管理
│   │   ├── authorizeSessionKey()
│   │   ├── revokeSessionKey()
│   │   └── isSessionKeyValid()
│   │
│   └── 狩猎逻辑
│       ├── huntWithSession()  # Relayer 调用
│       └── _executeHunt()     # 内部执行
│
├── libraries/
│   └── MemePool.sol          # Meme 池配置
│
└── test/
    └── MemeHunter.t.sol      # 测试
```

---

## 六、Meme 配置表

| ID | 图标 | 名称 | 稀有度 | 出现概率 | 移动速度 | 奖励 (MON) |
|----|------|------|--------|---------|---------|-----------|
| 1 | 🐸 | Pepe | Common | 40% | 慢 (2px/帧) | 0.02 |
| 2 | 🐶 | Doge | Common | 30% | 慢 (2px/帧) | 0.02 |
| 3 | 🦊 | Fox | Uncommon | 15% | 中 (4px/帧) | 0.05 |
| 4 | 💎 | Diamond | Rare | 10% | 快 (6px/帧) | 0.15 |
| 5 | 🚀 | Rocket | Epic | 5% | 很快 (8px/帧) | 0.50 |

### 捕网配置

| 尺寸 | 半径 | 费用/次 | 基础成功率 |
|------|------|--------|-----------|
| 小 | 40px | 0.005 MON | 60% |
| 中 | 70px | 0.01 MON | 50% |
| 大 | 100px | 0.02 MON | 40% |

> 最终成功率 = 基础成功率 × Meme稀有度系数

---

## 七、用户流程详解

### 流程图

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户进入网站                            │
└─────────────────────────────┬───────────────────────────────────┘
                              │
                              ▼
                    ┌───────────────────┐
                    │   连接钱包?       │
                    └─────────┬─────────┘
                              │
               ┌──────────────┼──────────────┐
               │ 未连接        │              │ 已连接
               ▼              │              ▼
        ┌─────────────┐       │      ┌─────────────────┐
        │ 显示首页    │       │      │ 检查余额        │
        │ Connect按钮 │       │      └────────┬────────┘
        └─────────────┘       │               │
                              │    ┌──────────┼──────────┐
                              │    │ 余额=0    │          │ 余额>0
                              │    ▼          │          ▼
                              │ ┌────────┐    │   ┌─────────────────┐
                              │ │充值弹窗│    │   │ 检查 Session Key │
                              │ └────────┘    │   └────────┬────────┘
                              │               │            │
                              │               │ ┌──────────┼──────────┐
                              │               │ │ 无/过期    │          │ 有效
                              │               │ ▼          │          ▼
                              │               │┌────────┐  │   ┌─────────────┐
                              │               ││授权弹窗│  │   │ 进入游戏页   │
                              │               │└────────┘  │   └─────────────┘
                              │               │            │
                              └───────────────┴────────────┘
```

---

### 狩猎交互流程

```
玩家点击画布位置 (x, y)
         │
         ▼
┌─────────────────────┐
│ 1. 播放捕网发射动画  │  ← 立即反馈
└─────────┬───────────┘
         │
         ▼
┌─────────────────────┐      ┌─────────────────────┐
│ 2. 前端碰撞检测     │──NO─▶│ 播放空网动画        │
│    网范围内有Meme?  │      │ 显示"这里没有Meme!" │
└─────────┬───────────┘      └─────────────────────┘
         │ YES
         ▼
┌─────────────────────┐
│ 3. Session Key签名  │  ← 本地签名,无弹窗
│    构造狩猎请求     │
└─────────┬───────────┘
         │
         ▼
┌─────────────────────┐
│ 4. 发送至 Relayer   │
└─────────┬───────────┘
         │
         ▼
┌─────────────────────┐
│ 5. Relayer 验证+上链│
└─────────┬───────────┘
         │
         ▼
┌─────────────────────┐
│ 6. 合约执行VRF判定  │
└─────────┬───────────┘
         │
    ┌────┴────┐
    │         │
 成功 ▼      ▼ 失败
┌─────────┐ ┌─────────┐
│捕获动画 │ │逃脱动画 │
│+奖励显示│ │-费用显示│
└─────────┘ └─────────┘
         │
         ▼
┌─────────────────────┐
│ 7. 更新余额显示     │
└─────────────────────┘
```

---

## 八、开发排期 (10天)

### 第一阶段：基础设施 (Day 1-3)

| 天 | 任务 | 产出 |
|----|------|------|
| **Day 1** | 智能合约开发 | MemeHunter.sol 完整代码 |
| | - 余额管理 (deposit/withdraw) | |
| | - Session Key 授权/验证 | |
| | - 狩猎逻辑 + 伪随机 | |
| **Day 2** | 合约测试 + 部署 | Monad 测试网部署地址 |
| | Relayer 基础搭建 | API 骨架 |
| **Day 3** | Relayer 完善 | 完整 Relayer 服务 |
| | - 签名验证 | |
| | - 交易广播 | |
| | - WebSocket 基础 | |

### 第二阶段：前端核心 (Day 4-6)

| 天 | 任务 | 产出 |
|----|------|------|
| **Day 4** | 前端项目搭建 | 基础框架 |
| | - React + Vite + Tailwind | |
| | - 钱包连接 (wagmi) | |
| | - 首页 UI | |
| **Day 5** | 游戏页基础 | 静态游戏界面 |
| | - 游戏画布 (Canvas) | |
| | - Meme 精灵渲染 | |
| | - Meme 移动逻辑 | |
| **Day 6** | Session Key 集成 | 无签名狩猎流程 |
| | - 本地密钥生成存储 | |
| | - 授权流程 | |
| | - Relayer 通信 | |

### 第三阶段：动画与体验 (Day 7-8)

| 天 | 任务 | 产出 |
|----|------|------|
| **Day 7** | 碰撞检测 + 狩猎逻辑 | 可玩的狩猎功能 |
| | - 前端碰撞检测 | |
| | - 空网判断 | |
| | - 狩猎请求发送 | |
| **Day 8** | 动画系统 | 完整动画反馈 |
| | - 捕网发射动画 | |
| | - 捕获成功动画 | |
| | - 逃脱动画 | |
| | - 空网动画 | |

### 第四阶段：联调与优化 (Day 9-10)

| 天 | 任务 | 产出 |
|----|------|------|
| **Day 9** | 全流程联调 | 完整可玩版本 |
| | - 充值 → 授权 → 狩猎 → 提现 | |
| | - 多玩家同步测试 | |
| | - Bug 修复 | |
| **Day 10** | 优化 + 部署 | **MVP 上线** |
| | - 性能优化 | |
| | - UI 细节打磨 | |
| | - 部署上线 | |

---

## 九、技术栈确认

| 层级 | 技术选型 | 说明 |
|------|---------|------|
| **智能合约** | Solidity + Foundry | EVM 兼容 |
| **前端框架** | React 18 + TypeScript | 现代化开发 |
| **构建工具** | Vite | 快速构建 |
| **样式** | Tailwind CSS | 快速原型 |
| **钱包连接** | wagmi + viem | 标准方案 |
| **Canvas** | 原生 Canvas API | 轻量,够用 |
| **动画** | CSS + Canvas | 混合方案 |
| **Relayer** | Node.js + Express | 简单可靠 |
| **实时通信** | Socket.io | WebSocket 封装 |
| **部署-前端** | Vercel | 免费 + 快速 |
| **部署-Relayer** | Railway | 简单部署 |

---

## 十、关键风险 & 应对

| 风险 | 概率 | 影响 | 应对方案 |
|------|------|------|---------|
| Monad 测试网不稳定 | 中 | 交易失败 | 乐观UI + 重试机制 |
| Canvas 动画性能问题 | 低 | 卡顿 | 限制同屏 Meme 数量 |
| Session Key 安全 | 低 | 资金损失 | 24h过期 + 余额限制 |
| 多人同步延迟 | 中 | 体验差 | 本地预测 + 服务端校正 |

---

## 十一、MVP 成功标准

- [ ] 用户可连接钱包并充值
- [ ] Session Key 授权后可无签名狩猎  
- [ ] 点击画布可看到捕网发射动画
- [ ] 空网时显示提示,不发交易
- [ ] 捕获成功/失败有明确动画反馈
- [ ] 余额实时更新
- [ ] 支持最多 10 人同时在线
- [ ] 可正常提现

---

这份方案聚焦 **核心狩猎体验**，去掉了所有非必要功能。10 天内可交付一个可玩的 MVP。需要我展开哪个模块的细节？🎯