# MemeHunter 后端接口文档

> **版本**: 2.0.0  
> **模式**: 中心化版本（无链上交互）  
> **Base URL**: `http://localhost:3001/api`

---

## 一、认证 API

### 1.1 游客登录

**POST** `/api/auth/guest`

创建新用户或恢复现有会话。

**请求体**:
```json
{
  "sessionId": "可选，现有 Session ID"
}
```

**响应**:
```json
{
  "success": true,
  "isNewUser": true,
  "user": {
    "id": "uuid",
    "sessionId": "uuid",
    "nickname": "AlphaMaster688",
    "walletAddress": null,
    "balance": 0,
    "totalEarned": 0
  },
  "sessionId": "uuid"
}
```

---

### 1.2 获取用户信息

**GET** `/api/user/profile`

**Header**: `X-Session-Id: <sessionId>` 或 `Authorization: Bearer <sessionId>`

**响应**:
```json
{
  "success": true,
  "user": {
    "id": "uuid",
    "nickname": "AlphaMaster688",
    "walletAddress": "So1ana...",
    "balance": 1500,
    "totalEarned": 3200
  }
}
```

---

### 1.3 获取积分余额

**GET** `/api/user/balance`

**Header**: `X-Session-Id: <sessionId>`

**响应**:
```json
{
  "success": true,
  "balance": 1500,
  "totalEarned": 3200
}
```

---

### 1.4 绑定钱包地址

**POST** `/api/user/bind-wallet`

**Header**: `X-Session-Id: <sessionId>`

**请求体**:
```json
{
  "walletAddress": "So1anaWa11etAddress..."
}
```

---

### 1.5 获取排行榜

**GET** `/api/leaderboard?limit=10`

**响应**:
```json
{
  "success": true,
  "leaderboard": [
    {
      "rank": 1,
      "nickname": "MoonWhale123",
      "balance": 5000,
      "totalEarned": 12000
    }
  ]
}
```

---

## 二、房间 API

### 2.1 获取房间列表

**GET** `/api/rooms?limit=20`

**响应**:
```json
{
  "success": true,
  "rooms": [
    {
      "id": "EE489BEE",
      "name": "Test Room",
      "tokenSymbol": "MEME",
      "status": "active",
      "playerCount": 3,
      "creatorNickname": "AlphaMaster688"
    }
  ],
  "count": 1
}
```

---

### 2.2 创建房间

**POST** `/api/rooms`

**Header**: `X-Session-Id: <sessionId>`

**请求体**:
```json
{
  "name": "My Room",
  "tokenSymbol": "MEME",
  "maxPlayers": 10,
  "memeCount": 8
}
```

**响应**:
```json
{
  "success": true,
  "room": {
    "id": "EE489BEE",
    "name": "My Room",
    "tokenSymbol": "MEME",
    "status": "active"
  }
}
```

---

### 2.3 获取房间详情

**GET** `/api/rooms/:id`

**响应**:
```json
{
  "success": true,
  "room": { ... },
  "stats": {
    "totalHunts": 150,
    "totalRewards": 3500,
    "uniquePlayers": 12,
    "currentPlayers": 3,
    "memeCount": 8
  }
}
```

---

### 2.4 获取房间二维码

**GET** `/api/rooms/:id/qrcode?baseUrl=https://example.com`

**响应**:
```json
{
  "success": true,
  "qrCode": "data:image/png;base64,...",
  "joinUrl": "https://example.com/room/EE489BEE"
}
```

---

## 三、领取 API

### 3.1 提交领取申请

**POST** `/api/withdraw`

**Header**: `X-Session-Id: <sessionId>`

**请求体**:
```json
{
  "walletAddress": "So1anaWa11etAddress...",
  "amount": 1000
}
```

**响应**:
```json
{
  "success": true,
  "request": {
    "id": "uuid",
    "amount": 1000,
    "status": "pending",
    "walletAddress": "So1ana..."
  }
}
```

---

### 3.2 领取历史

**GET** `/api/withdraw/history?limit=20`

**Header**: `X-Session-Id: <sessionId>`

---

## 四、WebSocket 事件

**连接**: `ws://localhost:3001`

### 客户端发送

| 事件 | 数据 | 描述 |
|-----|------|------|
| `guestLogin` | `{ sessionId? }` | 游客登录 |
| `joinRoom` | `{ roomId, sessionId }` | 加入房间 |
| `hunt` | `{ x, y, netSize, memeId }` | 狩猎请求 |
| `requestBalance` | `{}` | 请求余额 |

### 服务端发送

| 事件 | 描述 |
|-----|------|
| `loginSuccess` | 登录成功 |
| `roomJoined` | 加入房间成功 |
| `gameState` | 游戏状态同步 (10 FPS) |
| `huntResult` | 狩猎结果 |
| `balanceUpdate` | 余额更新 |
| `memeRemoved` | Meme 被移除 |
